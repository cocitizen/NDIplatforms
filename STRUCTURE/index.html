<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Structure - NDIplatforms</title>
  

  <link rel="shortcut icon" href="../_images/favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Structure";
    var mkdocs_page_input_path = "STRUCTURE.md";
    var mkdocs_page_url = "/STRUCTURE/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> NDIplatforms</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../INSTALL/">Install</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../USAGE/">Usage</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Structure</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#ndi-platforms">NDI PLATFORMS</a></li>
                
                    <li><a class="toctree-l4" href="#structure">STRUCTURE</a></li>
                
                    <li><a class="toctree-l4" href="#filesystem-layout">Filesystem layout</a></li>
                
                    <li><a class="toctree-l4" href="#stubs">Stubs</a></li>
                
                    <li><a class="toctree-l4" href="#includes">Includes</a></li>
                
                    <li><a class="toctree-l4" href="#lockfiles">Lockfiles</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../MAINTENANCE/">Maintenance</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../DOCUMENTATION/">Documentation</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">NDIplatforms</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Structure</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/NDItech/NDIplatforms" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="ndi-platforms">NDI PLATFORMS</h1>
<p>This document describes the filesystem layout for NDIplatforms Drush makefiles.
To understand how to use them to build platforms, please see docs/USAGE.md.
To better understand how these makefiles are maintained, please see
docs/MAINTENANCE.md.</p>
<h2 id="structure">STRUCTURE</h2>
<p>For simplicity, we are limiting our discussion to the DemTools Civi platform.
Several more platforms are included in NDIplatforms, and this system scales
very well.  However, listing them all here would complicate explanations.</p>
<h2 id="filesystem-layout">Filesystem layout</h2>
<p>Drush makefiles allow for the inclusion of other makefiles.  In order to reduce
duplication and encourage these makefiles to be self-documenting, NDIplatforms
makes extensive use of makefile includes.</p>
<p>Here is the (abridged) layout of files and directories:</p>
<pre><code>$ tree
.
├── docs
│   ...
├── includes
│   ├── civicrm
│   │   ├── civicrm.make.yml
│   │   ├── custom.make.yml
│   │   ...
│   ├── dkan
│   │   ...
│   └── drupal
│       ├── core.7.make.yml
│       ...
├── locks
│   ├── civicrm.lock.yml
│   ├── demtools-civi.lock.yml
│   ...
│   └── drupal7.lock.yml
├── Makefile
├── README.md
├── stubs
│   ├── civicrm.make.yml
│   ├── demtools-civi.make.yml
│   ...
│   └── drupal7.make.yml
└── tmp
    └── drush
</code></pre>
<p>There are 4 top-level directories: docs, includes, locks and stubs.  We examine
these in more detail later.  The locks and stubs directories simply contain
lockfiles in the former, and stub makefiles in the latter, with no further
hierarchy.</p>
<p>The "includes" directory, on the other hand, has subdirectories that contain
makefiles specific to each product.</p>
<h2 id="stubs">Stubs</h2>
<p>Stubs are makefiles that usually do not contain any projects to download
directly.  Instead, they include a version of core, and various other makefiles
to build up a full platform.</p>
<p>In the example below, we see that the contents are pretty basic.  There is
documentation throughout, as well as the basic Drush make "api" and "core"
elements.  We also set a default sub-directory within which to download
projects.  This allows us to keep our included makefiles cleaner.</p>
<p>We then include a core makefile, module, civicrm, and extensions makefiles and a
theme makefile.  Note that we specify the location of the include file relative
to the location of the stub.</p>
<pre><code>core = 7.x
api = 2

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;               Core               ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

includes[] = ../includes/core.make

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;             Defaults             ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

; Specify common subdir
defaults[projects][subdir] = "contrib"

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;         Released Modules         ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

includes[] = ../includes/modules.make

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;           CiviCRM core           ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

includes[] = ../includes/civicrm.make

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;        CiviCRM Extensions        ;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

includes[] = ../includes/civicrm-extensions.make
</code></pre>
<h2 id="includes">Includes</h2>
<p>In the includes directory we find a core makefile that includes a core
distribution and any patches we need to apply to Drupal.  These included
makefiles have standard headers similar to the stub makefile above.</p>
<p>In modules.make, we have a general list of modules.  This makefile lists all
the modules that will be downloaded as part of the platform.  We segment
related modules into their own dedicated makefiles, if this helps organization
or re-use.</p>
<h2 id="lockfiles">Lockfiles</h2>
<p>Finally, the lockfiles directory includes makefiles that have been run through
"drush make-lock" (see docs/MAINTENANCE.md).  This basically takes our stub
makefile, compiles all the inclusions, and then checks with drupal.org to
determine the latest versions of all the components, just as if they were all
going to be downloaded in a normal run of Drush make.  It then writes this out
into a new makefile that now specifies all the up-to-date versions.  This form
of makefile is called a lockfile, similar to what we see with Composer or Gem.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../MAINTENANCE/" class="btn btn-neutral float-right" title="Maintenance">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../USAGE/" class="btn btn-neutral" title="Usage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/NDItech/NDIplatforms" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../USAGE/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../MAINTENANCE/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
