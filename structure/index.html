<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Structure - NDIplatforms</title>
  

  <link rel="shortcut icon" href="../_images/favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../_css/menu.css" rel="stylesheet">
  <link href="../_css/term.css" rel="stylesheet">
  <link href="../_css/style.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Structure";
    var mkdocs_page_input_path = "structure.md";
    var mkdocs_page_url = "/structure/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> NDIplatforms</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../install/">Install</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../usage/">Usage</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Structure</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#structure">STRUCTURE</a></li>
                
                    <li><a class="toctree-l4" href="#filesystem-layout">Filesystem layout</a></li>
                
                    <li><a class="toctree-l4" href="#types-of-platforms">Types of platforms</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../maintenance/">Maintenance</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../documentation/">Documentation</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">NDIplatforms</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Structure</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/NDItech/NDIplatforms" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="structure">STRUCTURE <a href="https://travis-ci.org/nditech/NDIplatforms"><img alt="Build status" src="https://travis-ci.org/nditech/NDIplatforms.svg" /></a></h1>
<p>This section describes the filesystem layout for NDIplatforms Drush makefiles.
To understand how to use them to build platforms, please see the
<a href="../usage/">Usage</a> section. To better understand how these makefiles are
maintained, please see the <a href="../maintenance/">Maintenance</a> section.</p>
<h2 id="filesystem-layout">Filesystem layout</h2>
<p>For simplicity, we are limiting our discussion to the DemTools Civi and DKAN
platforms. Several more platforms will be included in NDIplatforms, and this
system scales very well. However, listing them all here would complicate
explanations.</p>
<p>Drush makefiles allow for the inclusion of other makefiles. In order to reduce
duplication and encourage these makefiles to be self-documenting, NDIplatforms
makes extensive use of makefile includes.</p>
<p>Here is the layout of <code>makefiles/</code> directory:</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #000080; font-weight: bold">$</span> tree makefiles
<span style="color: #888888">makefiles/</span>
<span style="color: #888888">├── cores</span>
<span style="color: #888888">│   ├── drupal7</span>
<span style="color: #888888">│   │   ├── build.yml</span>
<span style="color: #888888">│   │   ├── core.make.yml</span>
<span style="color: #888888">│   │   └── lock.yml</span>
<span style="color: #888888">│   └── drupal8</span>
<span style="color: #888888">│       ├── build.yml</span>
<span style="color: #888888">│       ├── core.make.yml</span>
<span style="color: #888888">│       └── lock.yml</span>
<span style="color: #888888">├── demtools</span>
<span style="color: #888888">│   ├── civicrm</span>
<span style="color: #888888">│   │   ├── build.yml</span>
<span style="color: #888888">│   │   ├── contrib.make.yml</span>
<span style="color: #888888">│   │   ├── custom.make.yml</span>
<span style="color: #888888">│   │   └── lock.yml</span>
<span style="color: #888888">│   └── dkan</span>
<span style="color: #888888">│       ├── build.yml</span>
<span style="color: #888888">│       ├── contrib.make.yml</span>
<span style="color: #888888">│       ├── custom.make.yml</span>
<span style="color: #888888">│       └── lock.yml</span>
<span style="color: #888888">└── stock</span>
<span style="color: #888888">    ├── civicrm</span>
<span style="color: #888888">    │   ├── build.yml</span>
<span style="color: #888888">    │   ├── contrib.make.yml</span>
<span style="color: #888888">    │   └── lock.yml</span>
<span style="color: #888888">    └── dkan</span>
<span style="color: #888888">        ├── build.yml</span>
<span style="color: #888888">        ├── lock.yml</span>
<span style="color: #888888">        └── profile.make.yml</span>

<span style="color: #888888">9 directories, 20 files</span>
</pre></div>


<p>There are 3 top-level directories: <code>cores/</code>, <code>stock/</code> and <code>demtools/</code>. Each of
these include a directory for a number of flavours. Wthin each of these, we
find the actual makefiles, build files and lockfiles. We examine these in more
detail later.</p>
<h3 id="types-of-drush-makefiles">Types of Drush makefiles</h3>
<h4 id="42makeyml">*.make.yml</h4>
<p>These Drush makefiles define projects and libraries, but normally don't specify
any versions. They are not usually used on their own. Instead they get included
in build makefiles.</p>
<h4 id="buildyml">build.yml</h4>
<p>Build makefiles, sometimes called stubs, do not contain any actual project
definitions. Instead, they only include other makefiles (of the .make.yml
variety) that define the core, extentions, and themes used. It may also contain
overrides to the projects defined in the includes.</p>
<h4 id="lockyml">lock.yml</h4>
<p>Lockfiles are generated from build makefiles (see the
<a href="../maintenance/">Maintenance</a> section. They have versions specified for all
projects. This helps in ensuring that deployments of platforms (code-bases)
from them are repeatable.  This process takes a stub (build) makefile, compiles
all its inclusions, then checks with http://update.drupal.org to determine the
latest versions of all the components. This is then written out as a lockfile,
similar to what we see with Composer or Gem.</p>
<h2 id="types-of-platforms">Types of platforms</h2>
<p>To encourage re-use and modularity, we split up our makefiles into "layers".
Each layer includes the lockfile(s) generate from the the previous one.</p>
<h3 id="cores">Cores</h3>
<p>Cores simply contain various versions of Drupal. The lockfiles get included
into the stock <code>build.yml</code> files.</p>
<h3 id="stock">Stock</h3>
<p><code>stock/</code> contains minimalist implementations of underlying applications:
CiviCRM and DKAN (so far). These are useful for debugging, and isolating issues
between the applications and the DemTools customizations.</p>
<p>The <code>build.yml</code> files each include a core lockfile, along with any makefiles.
The generated lockfiles, are then included in the DemTools <code>build.yml</code> files.</p>
<h3 id="demtools">DemTools</h3>
<p>Finally, <code>demtools/</code> contains the platforms used by DemTools: stock
applications plus addtional contrib and custom components, as well as overrides
to the projects included from lower layers.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../maintenance/" class="btn btn-neutral float-right" title="Maintenance">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../usage/" class="btn btn-neutral" title="Usage"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/NDItech/NDIplatforms" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../usage/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../maintenance/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
