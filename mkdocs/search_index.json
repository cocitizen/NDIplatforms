{
    "docs": [
        {
            "location": "/", 
            "text": "NDI PLATFORMS \n\n\nNDIplatforms is a set of Drush makefiles structured for easy maintenance. It\nis used, along with the \nAegir Hosting System\n, to\nmaintain NDI's \nDemTools\n mass-hosting platform, DemCloud.\n\n\nNormal usage of NDIplatforms involves simply running Drush Make with one of the\nsupplied \"lock\" files. Lockfiles are simply makefiles with all versions\ncompletely specified. Further instructions can be found on the\n\nUsage\n section.\n\n\nNDIplatforms uses a particular directory layout to make maintaining makefiles\neasier. For a discussion on the reasoning behind this, see the\n\nStructure\n section.\n\n\nThe maintenance of NDIplatforms leverages a number of features that are new to\nDrush 8. See the \nInstall\n section for a detailed walk-through of\ninstalling NDIplatforms and its dependencies.\n\n\nA specific workflow was developed to maintain the \"lock\" files. This workflow\nis described in the \nMaintenance\n section.\n\n\nThis documentation is managed with \nmkdocs\n. For\ninformation on getting started, see the \nDocumentation\n\nsection.", 
            "title": "Home"
        }, 
        {
            "location": "/#ndi-platforms", 
            "text": "NDIplatforms is a set of Drush makefiles structured for easy maintenance. It\nis used, along with the  Aegir Hosting System , to\nmaintain NDI's  DemTools  mass-hosting platform, DemCloud.  Normal usage of NDIplatforms involves simply running Drush Make with one of the\nsupplied \"lock\" files. Lockfiles are simply makefiles with all versions\ncompletely specified. Further instructions can be found on the Usage  section.  NDIplatforms uses a particular directory layout to make maintaining makefiles\neasier. For a discussion on the reasoning behind this, see the Structure  section.  The maintenance of NDIplatforms leverages a number of features that are new to\nDrush 8. See the  Install  section for a detailed walk-through of\ninstalling NDIplatforms and its dependencies.  A specific workflow was developed to maintain the \"lock\" files. This workflow\nis described in the  Maintenance  section.  This documentation is managed with  mkdocs . For\ninformation on getting started, see the  Documentation \nsection.", 
            "title": "NDI PLATFORMS"
        }, 
        {
            "location": "/install/", 
            "text": "INSTALLATION \n\n\nDownload\n\n\nDownload NDIplatforms somewhere convenient, such as:\n\n\n$\n git clone https://github.com/nditech/NDIplatforms.git ~/makefiles/NDIplatforms\n\n$\n \ncd\n ~/makefiles/NDIplatforms\n\n\n\n\n\nInstall\n\n\nTo use the latest version of NDIplatforms effectively, you need a recent version\nof Drush. As such, we recommend using a local Drush install, so as not to\ninterfere with other Drush functionality on the server.\n\n\nThere are various options available, that are explained further in the next\nsection. Use the following command to install the recommended version of Drush:\n\n\n$\n make install\n\nSwitched to branch \ndev/2000\n\n\n[...]\n\n\n Drush git branch: dev/2000\n\n\n\n\n\n\nInstall Drush\n\n\nIf you prefer to use the latest release of Drush:\n\n\n$\n make drush\n\n Drush Version   :  8.0.3\n\n\n\n\n\n\nAlternatively, you might want to use the latest (unstable) Drush development\nbuild:\n\n\n$\n make drush-unstable\n\n Drush Version   :  8.1-dev\n\n\n\n\n\n\nYou could also deploy Drush from source code:\n\n\n$\n make drush-source\n\nAlready on \nmaster\n\n\n[...]\n\n\nAll settings correct for using Composer\n\n\nDownloading...\n\n\n[...]\n\n\n Drush Version   :  8.1-dev\n\n\n\n\n\n\nFinally, deploying Drush from source code allows the use of arbitrary branches\n(from a PR, for example):\n\n\n$\n make drush-source \nbranch\n=\ndev/2000\n\nSwitched to branch \ndev/2000\n\n\n[...]\n\n\n Drush git branch: dev/2000", 
            "title": "Install"
        }, 
        {
            "location": "/install/#installation", 
            "text": "", 
            "title": "INSTALLATION"
        }, 
        {
            "location": "/install/#download", 
            "text": "Download NDIplatforms somewhere convenient, such as:  $  git clone https://github.com/nditech/NDIplatforms.git ~/makefiles/NDIplatforms $   cd  ~/makefiles/NDIplatforms", 
            "title": "Download"
        }, 
        {
            "location": "/install/#install", 
            "text": "To use the latest version of NDIplatforms effectively, you need a recent version\nof Drush. As such, we recommend using a local Drush install, so as not to\ninterfere with other Drush functionality on the server.  There are various options available, that are explained further in the next\nsection. Use the following command to install the recommended version of Drush:  $  make install Switched to branch  dev/2000  [...]   Drush git branch: dev/2000", 
            "title": "Install"
        }, 
        {
            "location": "/install/#install-drush", 
            "text": "If you prefer to use the latest release of Drush:  $  make drush  Drush Version   :  8.0.3   Alternatively, you might want to use the latest (unstable) Drush development\nbuild:  $  make drush-unstable  Drush Version   :  8.1-dev   You could also deploy Drush from source code:  $  make drush-source Already on  master  [...]  All settings correct for using Composer  Downloading...  [...]   Drush Version   :  8.1-dev   Finally, deploying Drush from source code allows the use of arbitrary branches\n(from a PR, for example):  $  make drush-source  branch = dev/2000 Switched to branch  dev/2000  [...]   Drush git branch: dev/2000", 
            "title": "Install Drush"
        }, 
        {
            "location": "/usage/", 
            "text": "USAGE \n\n\nThis section describes building platforms using the NDIplatforms stub Drush\nmakefiles. To understand how these makefiles are maintained, please see\nthe \nMaintenance\n section.\n\n\nGNU Make\n\n\nWhile most of Drupal platform creation refers to Drush makefiles, this project\nincludes a \nGNU Makefile\n to simplify its\nusage. To see what commands are available, run:\n\n\n$\n make list\n\n\n\n\n\nFor simplicity, we use the \"demtools/dkan\" platform in our examples. Obviously,\nreplace this with whichever platform stub makefile is appropriate.\n\n\nTest a platform build\n\n\nBefore proceeding with deploying a platform for production use, it can be\nuseful to run a test build, to see if there are any errors in the lockfile.\nNote that we run \nautomated tests\n\nto build the DemTools platforms after each code push to the NDIplatforms\nproject. However, changes to included project (e.g., reference git branch\ndeleted) since then might cause a build to break.\n\n\nTo run a test build, simply run:\n\n\n$\n make demtools/dkan-test\n\nBeginning to build makefiles/demtools/dkan/lock.yml.           [ok]\n\n\ndrupal-7.43 downloaded.                                        [ok]\n\n\n[...]\n\n\n\n\n\n\nEach DemTools platform (demtools/dkan, demtools/civicrm, etc.) have such a test\ncommand defined (although it may not show up in the \nmake list\n output).\n\n\nNote that running such a test will re-compile any relevant lockfiles whose\nsources have changed. See the \nStructure\n and\n\nMaintenance\n sections for further details.\n\n\nBuild a platform\n\n\nThe easiest way to build a platform is to use the provided Make commands:\n\n\n$\n make demtools/dkan-platform\n\nBeginning to build makefiles/demtools/dkan/lock.yml.           [ok]\n\n\ndrupal-7.43 downloaded.                                        [ok]\n\n\n[...]\n\n\n\n\n\n\nEach DemTools platform (demtools/dkan, demtools/civicrm, etc.) has such a\nplatform build command defined (although it may not show up in the \nmake list\n\noutput).\n\n\nThis command will build the platform to the usual production path on a stock\nAegir system, create an Aegir \"context\" (Drush alias), and import the resulting\nplatform into the Aegir front-end.\n\n\nThe resulting platform will incorporate a date-stamp to make it simple to see\nwhich is the most current. If multiple platforms of the same type are required\nduring the course of a single day (e.g., for iterative bug fixing and testing),\nwe can include a revision counter to keep platforms and aliases unique. To do\nso, simply add \ninc=\nsuffix\n when calling the platform build command:\n\n\n$\n make demtools/dkan-platform \ninc\n=\na\n\nBeginning to build makefiles/demtools/dkan/lock.yml.           [ok]\n\n\ndrupal-7.43 downloaded.                                        [ok]\n\n\n[...]\n\n\n\n\n\n\nBuild a platform on the command-line\n\n\nTo build a platform (also referred to as a code-base), we can also use Drush\nMake directly, along with our lockfiles. We start by simply calling Drush make\n(usually as the \"aegir\" user):\n\n\n$\n drush make ~/makefiles/NDIplatforms/makefiles/demtools/dkan/lock.yml ~/platforms/DemTools_DKAN_2016-02-22\n\nBeginning to build makefiles/demtools/dkan/lock.yml.            [ok]\n\n\ndrupal-7.43 downloaded.                                         [ok]\n\n\n[...]\n\n\n\n\n\n\nAssuming that the platform build worked, we then need to tell Aegir about it.\nThe easiest way to do that is to visit \n/node/add/platform\n on the Aegir site.\nWe then need to provide a name, such as \"DemTools_DKAN_2016-02-22\", and specify\nthe path where we built it.\n\n\nThis can also be accomplished at the command-line by running the provision-save\nand hosting-import Drush commands provided by Aegir. However, this is a very\nadvanced technique which we will not cover here.  Use the \"--help\" option with\nthese commands to see how they work, or check out our use in the Makefile that\nships with NDIplatforms.\n\n\nBuild a platform in the Aegir UI\n\n\nAlternatively, we can build the platform directly from within the Aegir UI.\nThis is the preferred method, as it:\n\n\n\n\nmakes the output of the platform build available in the task log;\n\n\ncreates a link to the makefile that was used in building the platform; and\n\n\navoids having to import the platform separately.\n\n\n\n\nHowever, YAML-formatted makefiles require Drush 8, which only shipped with\nAegir Debian packages starting in version 3.4. As a result, building from the\ncommand line may be required, if you are using an older version.\n\n\nFirst, find the lockfile we want to use to build the platform on Github. Visit\nthe \nNDIplatforms project on GitHub\n.\nFrom here, we'll want to work from the latest commit, as this will allow us to\nspecify the commit hash in the makefile path. The benefit of doing so, is that\nwe'll know \nexactly\n what the makefile contained at the time that we buil this\nplatform. This can turn out to be very useful later.\n\n\nEither follow the \"Latest commit\" link, or append\n\n/commit/HEAD\n to the\nproject URL. We'll start seeing a long commit hash is subsequently. Click on\nthe \"Browse files\" link to get back to the tree view of the project. Then\nnavigate into the \nmakefiles/demtools/\n directory, and choose which DemTools\nplatform to build.\n\n\nIn this directory, we'll find a \nlock.yml\n file. This will show all the\ncomponents that will be pulled together to form the platform.  Next, click the\n\"Raw\" button to get a link to the output that Drush Make can\naccept. Here's an example of such a URL:\n\n\n\n\nhttps://raw.githubusercontent.com/nditech/NDIplatforms/5f93ef3c183574a79a7132bfce865e3f76894235/makefiles/demtools/dkan/lock.yml\n\n\n\n\nCopy that URL into the \"makefile\" field on \"/node/add/platform\" on the\nAegir site. Then provide a meaningful name, such as \"DemTools_2016-02-25\", and\nclick \"Save\".\n\n\nThat should be all that is required. In the background, Aegir will download the\nmakefile, run Drush Make, and register the platform. You should see a link to\nthe makefile used in creating the platform. This is useful to determine the\nexact platform contents, or for re-creating the platform elsewhere, such as on\na different server.", 
            "title": "Usage"
        }, 
        {
            "location": "/usage/#usage", 
            "text": "This section describes building platforms using the NDIplatforms stub Drush\nmakefiles. To understand how these makefiles are maintained, please see\nthe  Maintenance  section.", 
            "title": "USAGE"
        }, 
        {
            "location": "/usage/#gnu-make", 
            "text": "While most of Drupal platform creation refers to Drush makefiles, this project\nincludes a  GNU Makefile  to simplify its\nusage. To see what commands are available, run:  $  make list  For simplicity, we use the \"demtools/dkan\" platform in our examples. Obviously,\nreplace this with whichever platform stub makefile is appropriate.", 
            "title": "GNU Make"
        }, 
        {
            "location": "/usage/#test-a-platform-build", 
            "text": "Before proceeding with deploying a platform for production use, it can be\nuseful to run a test build, to see if there are any errors in the lockfile.\nNote that we run  automated tests \nto build the DemTools platforms after each code push to the NDIplatforms\nproject. However, changes to included project (e.g., reference git branch\ndeleted) since then might cause a build to break.  To run a test build, simply run:  $  make demtools/dkan-test Beginning to build makefiles/demtools/dkan/lock.yml.           [ok]  drupal-7.43 downloaded.                                        [ok]  [...]   Each DemTools platform (demtools/dkan, demtools/civicrm, etc.) have such a test\ncommand defined (although it may not show up in the  make list  output).  Note that running such a test will re-compile any relevant lockfiles whose\nsources have changed. See the  Structure  and Maintenance  sections for further details.", 
            "title": "Test a platform build"
        }, 
        {
            "location": "/usage/#build-a-platform", 
            "text": "The easiest way to build a platform is to use the provided Make commands:  $  make demtools/dkan-platform Beginning to build makefiles/demtools/dkan/lock.yml.           [ok]  drupal-7.43 downloaded.                                        [ok]  [...]   Each DemTools platform (demtools/dkan, demtools/civicrm, etc.) has such a\nplatform build command defined (although it may not show up in the  make list \noutput).  This command will build the platform to the usual production path on a stock\nAegir system, create an Aegir \"context\" (Drush alias), and import the resulting\nplatform into the Aegir front-end.  The resulting platform will incorporate a date-stamp to make it simple to see\nwhich is the most current. If multiple platforms of the same type are required\nduring the course of a single day (e.g., for iterative bug fixing and testing),\nwe can include a revision counter to keep platforms and aliases unique. To do\nso, simply add  inc= suffix  when calling the platform build command:  $  make demtools/dkan-platform  inc = a Beginning to build makefiles/demtools/dkan/lock.yml.           [ok]  drupal-7.43 downloaded.                                        [ok]  [...]", 
            "title": "Build a platform"
        }, 
        {
            "location": "/usage/#build-a-platform-on-the-command-line", 
            "text": "To build a platform (also referred to as a code-base), we can also use Drush\nMake directly, along with our lockfiles. We start by simply calling Drush make\n(usually as the \"aegir\" user):  $  drush make ~/makefiles/NDIplatforms/makefiles/demtools/dkan/lock.yml ~/platforms/DemTools_DKAN_2016-02-22 Beginning to build makefiles/demtools/dkan/lock.yml.            [ok]  drupal-7.43 downloaded.                                         [ok]  [...]   Assuming that the platform build worked, we then need to tell Aegir about it.\nThe easiest way to do that is to visit  /node/add/platform  on the Aegir site.\nWe then need to provide a name, such as \"DemTools_DKAN_2016-02-22\", and specify\nthe path where we built it.  This can also be accomplished at the command-line by running the provision-save\nand hosting-import Drush commands provided by Aegir. However, this is a very\nadvanced technique which we will not cover here.  Use the \"--help\" option with\nthese commands to see how they work, or check out our use in the Makefile that\nships with NDIplatforms.", 
            "title": "Build a platform on the command-line"
        }, 
        {
            "location": "/usage/#build-a-platform-in-the-aegir-ui", 
            "text": "Alternatively, we can build the platform directly from within the Aegir UI.\nThis is the preferred method, as it:   makes the output of the platform build available in the task log;  creates a link to the makefile that was used in building the platform; and  avoids having to import the platform separately.   However, YAML-formatted makefiles require Drush 8, which only shipped with\nAegir Debian packages starting in version 3.4. As a result, building from the\ncommand line may be required, if you are using an older version.  First, find the lockfile we want to use to build the platform on Github. Visit\nthe  NDIplatforms project on GitHub .\nFrom here, we'll want to work from the latest commit, as this will allow us to\nspecify the commit hash in the makefile path. The benefit of doing so, is that\nwe'll know  exactly  what the makefile contained at the time that we buil this\nplatform. This can turn out to be very useful later.  Either follow the \"Latest commit\" link, or append /commit/HEAD  to the\nproject URL. We'll start seeing a long commit hash is subsequently. Click on\nthe \"Browse files\" link to get back to the tree view of the project. Then\nnavigate into the  makefiles/demtools/  directory, and choose which DemTools\nplatform to build.  In this directory, we'll find a  lock.yml  file. This will show all the\ncomponents that will be pulled together to form the platform.  Next, click the\n\"Raw\" button to get a link to the output that Drush Make can\naccept. Here's an example of such a URL:   https://raw.githubusercontent.com/nditech/NDIplatforms/5f93ef3c183574a79a7132bfce865e3f76894235/makefiles/demtools/dkan/lock.yml   Copy that URL into the \"makefile\" field on \"/node/add/platform\" on the\nAegir site. Then provide a meaningful name, such as \"DemTools_2016-02-25\", and\nclick \"Save\".  That should be all that is required. In the background, Aegir will download the\nmakefile, run Drush Make, and register the platform. You should see a link to\nthe makefile used in creating the platform. This is useful to determine the\nexact platform contents, or for re-creating the platform elsewhere, such as on\na different server.", 
            "title": "Build a platform in the Aegir UI"
        }, 
        {
            "location": "/structure/", 
            "text": "STRUCTURE \n\n\nThis section describes the filesystem layout for NDIplatforms Drush makefiles.\nTo understand how to use them to build platforms, please see the\n\nUsage\n section. To better understand how these makefiles are\nmaintained, please see the \nMaintenance\n section.\n\n\nFilesystem layout\n\n\nFor simplicity, we are limiting our discussion to the DemTools Civi and DKAN\nplatforms. Several more platforms will be included in NDIplatforms, and this\nsystem scales very well. However, listing them all here would complicate\nexplanations.\n\n\nDrush makefiles allow for the inclusion of other makefiles. In order to reduce\nduplication and encourage these makefiles to be self-documenting, NDIplatforms\nmakes extensive use of makefile includes.\n\n\nHere is the layout of \nmakefiles/\n directory:\n\n\n$\n tree makefiles\n\nmakefiles/\n\n\n\u251c\u2500\u2500 cores\n\n\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 drupal7\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yml\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 core.make.yml\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 lock.yml\n\n\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 drupal8\n\n\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 build.yml\n\n\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 core.make.yml\n\n\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 lock.yml\n\n\n\u251c\u2500\u2500 demtools\n\n\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 civicrm\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yml\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 contrib.make.yml\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 custom.make.yml\n\n\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 lock.yml\n\n\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 dkan\n\n\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 build.yml\n\n\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 contrib.make.yml\n\n\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 custom.make.yml\n\n\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 lock.yml\n\n\n\u2514\u2500\u2500 stock\n\n\n    \u251c\u2500\u2500 civicrm\n\n\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yml\n\n\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 contrib.make.yml\n\n\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 lock.yml\n\n\n    \u2514\u2500\u2500 dkan\n\n\n        \u251c\u2500\u2500 build.yml\n\n\n        \u251c\u2500\u2500 lock.yml\n\n\n        \u2514\u2500\u2500 profile.make.yml\n\n\n\n9 directories, 20 files\n\n\n\n\n\n\nThere are 3 top-level directories: \ncores/\n, \nstock/\n and \ndemtools/\n. We\nexamine these in more detail later.\n\n\nTypes of Drush makefiles\n\n\n*.make.yml\n\n\nThese Drush makefiles define projects and libraries, but normally don't specify\nany versions. They are not usually used on their own. Instead they get included\nin build makefiles.\n\n\nbuild.yml\n\n\nBuild makefiles, sometimes called stubs, do not contain any actual project\ndefinitions. Instead, they only include other makefiles (of the .make.yml\nvariety) that define the core, extentions, and themes used. It may also contain\noverrides to the projects defined in the includes.\n\n\nlock.yml\n\n\nLockfiles are generated from build makefiles (see the\n\nMaintenance\n section. They have versions specified for all\nprojects. This helps in ensuring that deployments of platforms (code-bases)\nfrom them are repeatable.  This process takes a stub (build) makefile, compiles\nall its inclusions, then checks with http://update.drupal.org to determine the\nlatest versions of all the components. This is then written out as a lockfile,\nsimilar to what we see with Composer or Gem.\n\n\nTypes of platforms\n\n\nTo encourage re-use and modularity, we split up our makefiles into \"layers\".\nEach layer includes the lockfile(s) generate from the the previous one.\n\n\nCores\n\n\nCores simply contain various versions of Drupal. The lockfiles get included\ninto the stock \nbuild.yml\n files.\n\n\nStock\n\n\nstock/\n contains basic implementations of underlying applications: CiviCRM and\nDKAN. These are useful for debugging, and isolating issues between the\napplications and the DemTools customizations.\n\n\nThe \nbuild.yml\n files each include a core lockfile. The generated lockfiles,\nare then included in the DemTools \nbuild.yml\n files.\n\n\nDemTools\n\n\nFinally, \ndemtools/\n contains the platforms used by DemTools: stock\napplications plus addtional contrib and custom components, as well as overrides\nto the projects included from lower layers.", 
            "title": "Structure"
        }, 
        {
            "location": "/structure/#structure", 
            "text": "This section describes the filesystem layout for NDIplatforms Drush makefiles.\nTo understand how to use them to build platforms, please see the Usage  section. To better understand how these makefiles are\nmaintained, please see the  Maintenance  section.", 
            "title": "STRUCTURE"
        }, 
        {
            "location": "/structure/#filesystem-layout", 
            "text": "For simplicity, we are limiting our discussion to the DemTools Civi and DKAN\nplatforms. Several more platforms will be included in NDIplatforms, and this\nsystem scales very well. However, listing them all here would complicate\nexplanations.  Drush makefiles allow for the inclusion of other makefiles. In order to reduce\nduplication and encourage these makefiles to be self-documenting, NDIplatforms\nmakes extensive use of makefile includes.  Here is the layout of  makefiles/  directory:  $  tree makefiles makefiles/  \u251c\u2500\u2500 cores  \u2502\u00a0\u00a0 \u251c\u2500\u2500 drupal7  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yml  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 core.make.yml  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 lock.yml  \u2502\u00a0\u00a0 \u2514\u2500\u2500 drupal8  \u2502\u00a0\u00a0     \u251c\u2500\u2500 build.yml  \u2502\u00a0\u00a0     \u251c\u2500\u2500 core.make.yml  \u2502\u00a0\u00a0     \u2514\u2500\u2500 lock.yml  \u251c\u2500\u2500 demtools  \u2502\u00a0\u00a0 \u251c\u2500\u2500 civicrm  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yml  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 contrib.make.yml  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 custom.make.yml  \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 lock.yml  \u2502\u00a0\u00a0 \u2514\u2500\u2500 dkan  \u2502\u00a0\u00a0     \u251c\u2500\u2500 build.yml  \u2502\u00a0\u00a0     \u251c\u2500\u2500 contrib.make.yml  \u2502\u00a0\u00a0     \u251c\u2500\u2500 custom.make.yml  \u2502\u00a0\u00a0     \u2514\u2500\u2500 lock.yml  \u2514\u2500\u2500 stock      \u251c\u2500\u2500 civicrm      \u2502\u00a0\u00a0 \u251c\u2500\u2500 build.yml      \u2502\u00a0\u00a0 \u251c\u2500\u2500 contrib.make.yml      \u2502\u00a0\u00a0 \u2514\u2500\u2500 lock.yml      \u2514\u2500\u2500 dkan          \u251c\u2500\u2500 build.yml          \u251c\u2500\u2500 lock.yml          \u2514\u2500\u2500 profile.make.yml  9 directories, 20 files   There are 3 top-level directories:  cores/ ,  stock/  and  demtools/ . We\nexamine these in more detail later.", 
            "title": "Filesystem layout"
        }, 
        {
            "location": "/structure/#types-of-drush-makefiles", 
            "text": "", 
            "title": "Types of Drush makefiles"
        }, 
        {
            "location": "/structure/#42makeyml", 
            "text": "These Drush makefiles define projects and libraries, but normally don't specify\nany versions. They are not usually used on their own. Instead they get included\nin build makefiles.", 
            "title": "*.make.yml"
        }, 
        {
            "location": "/structure/#buildyml", 
            "text": "Build makefiles, sometimes called stubs, do not contain any actual project\ndefinitions. Instead, they only include other makefiles (of the .make.yml\nvariety) that define the core, extentions, and themes used. It may also contain\noverrides to the projects defined in the includes.", 
            "title": "build.yml"
        }, 
        {
            "location": "/structure/#lockyml", 
            "text": "Lockfiles are generated from build makefiles (see the Maintenance  section. They have versions specified for all\nprojects. This helps in ensuring that deployments of platforms (code-bases)\nfrom them are repeatable.  This process takes a stub (build) makefile, compiles\nall its inclusions, then checks with http://update.drupal.org to determine the\nlatest versions of all the components. This is then written out as a lockfile,\nsimilar to what we see with Composer or Gem.", 
            "title": "lock.yml"
        }, 
        {
            "location": "/structure/#types-of-platforms", 
            "text": "To encourage re-use and modularity, we split up our makefiles into \"layers\".\nEach layer includes the lockfile(s) generate from the the previous one.", 
            "title": "Types of platforms"
        }, 
        {
            "location": "/structure/#cores", 
            "text": "Cores simply contain various versions of Drupal. The lockfiles get included\ninto the stock  build.yml  files.", 
            "title": "Cores"
        }, 
        {
            "location": "/structure/#stock", 
            "text": "stock/  contains basic implementations of underlying applications: CiviCRM and\nDKAN. These are useful for debugging, and isolating issues between the\napplications and the DemTools customizations.  The  build.yml  files each include a core lockfile. The generated lockfiles,\nare then included in the DemTools  build.yml  files.", 
            "title": "Stock"
        }, 
        {
            "location": "/structure/#demtools", 
            "text": "Finally,  demtools/  contains the platforms used by DemTools: stock\napplications plus addtional contrib and custom components, as well as overrides\nto the projects included from lower layers.", 
            "title": "DemTools"
        }, 
        {
            "location": "/maintenance/", 
            "text": "MAINTENANCE \n\n\nThis section describes how to maintain Drush Make lockfiles. To understand how\nto build platforms using them, please see the \nUsage\n section. To\nbetter understand how these makefiles are structured, please see the\n\nStructure\n section.\n\n\nPlease follow the installation instructions in the \nInstall\n\nsection, as we currently recommend using a git version of Drush. The usage\ninstructions below assume that you have followed those instructions exactly.\n\n\nFor simplicity, we use the \"demtools/dkan\" project (unless otherwis specified)\nin our examples. Obviously, replace this with whichever platform is\nappropriate.\n\n\nDrush Make lockfiles\n\n\nThe principle benefit of using lockfiles, over regular makefiles, is that they\nallow us to build the same platform in a repeatable fashion. A lockfile is\nsimply a type of makefile generated by Drush, that specifies all the versions\nfor all the included projects. Otherwise, we might get a different platform\neach time we build, depending on how many projects we include, their release\ncycle and/or the pace of their development.\n\n\nAlso, lockfiles allow us to build platforms using the lockfiles remotely,\nwithout having to be concerned with any includes being specified locally. For\nexample, we can use the raw output of a git repository containing such a\nlockfile, and be confident that any subseqent platform built with that same URL\nwill be identical.\n\n\nUpdate your makefiles\n\n\nUnder normal circumstances, you'll only need to modify makefiles to add or\nremove components from your platform build. Some (very few) makefiles require\nmanual updates to version numbers. The only use-case we are currently aware of\nis when downloading a project or library using the \nget\n download type. An\nexample of this can be seen in \nmakefiles/stock/civicrm/contrib.make.yml\n:\n\n\nprojects:\n  civicrm:\n    type: module\n    download:\n      type: get\n      url: \nhttp://downloads.sourceforge.net/project/civicrm/civicrm-stable/4.6.13/civicrm-4.6.13-drupal.tar.gz\n\n\n\n\n\n\nWe can see the result of updating a makefile by building our lockfiles with\n\nmake all\n and \ngit diff\n. But that is covered in more detail in the next section.\n\n\nPinning major versions\n\n\nOccasionally we'll see a new major version of a project released. By default,\nDrush Make will select the most recent supported version of a project. As a\nresult, our lockfiles would show a major version bump as well. Generally\nspeaking, major version upgrades of modules are not a part of the day-to-day\nmaintenance of platforms. They will likely require some manual intervention,\nor, at very least, thorough testing.\n\n\nAssuming the current version of such a component is still supported, the most\nexpedient solution is likely to involve pinning a major version for the module.\nThis allows new releases on that branch to be incorporated automatically.\n\n\nFor example, in \nmakefiles/demtools/civicrm/contrib.make.yml\n, we could replace\nthis:\n\n\nprojects:\n  webform:  { \nversion\n: \n~\n }\n\n\n\n\n\nWith the following:\n\n\nprojects:\n  webform:\n    \n# The recommended release is on the 4.x branch, so we pin to the latest\n\n    \n# supported version on the 3.x branch.\n\n    version: 3\n\n\n\n\n\nNote that it is usually worthwhile to document the reasons for such pinning.\nRebuild the lockfiles, and check what has changed:\n\n\n$\n make all\n\ntmp/drush make-lock makefiles/demtools/civicrm/build.yml --result-file=makefiles/demtools/civicrm/lock.yml\n\n\nWrote .make file makefiles/demtools/civicrm/lock.yml                                                                       [ok]\n\n\n$\n git diff makefiles/demtools/civicrm/lock.yml\n\n\n\n\n\nThe resulting diff should show something like this:\n\n\ndiff --git a/makefiles/demtools/civicrm/lock.yml b/makefiles/demtools/civicrm/lock.yml\n\n\nindex d3ab256..212a373 100644\n\n\n--- a/makefiles/demtools/civicrm/lock.yml\n\n\n+++ b/makefiles/demtools/civicrm/lock.yml\n\n\n@@ -58,7 +58,7 @@ projects:\n\n   webform_civicrm:\n     version: \n4.15\n\n   webform:\n\n-    version: \n4.12\n\n\n+    version: \n3.24\n\n   libraries:\n     version: \n2.2\n\n   options_element:\n\n\n\n\n\nUpdate the lockfiles\n\n\nWe use a GNU Makefile to simplify updates to lockfiles. This Makefile defines\ndependencies between the various lockfiles, and their includes. This means that\nwhen a (Drush) makefile is updated, all lockfiles that include that makefile\nwill be rebuilt.\n\n\nSince we keep all our lockfiles in git, it's often easiest to simply force the\nre-compilation of all the lockfiles:\n\n\n$\n make all -B\n\ntmp/drush make-lock makefiles/cores/drupal7/build.yml --result-file=makefiles/cores/drupal7/lock.yml\n\n\nWrote .make file makefiles/cores/drupal7/lock.yml                                                                          [ok]\n\n\ntmp/drush make-lock makefiles/cores/drupal8/build.yml --result-file=makefiles/cores/drupal8/lock.yml\n\n\nWrote .make file makefiles/cores/drupal8/lock.yml                                                                          [ok]\n\n\ntmp/drush make-lock makefiles/stock/dkan/build.yml --result-file=makefiles/stock/dkan/lock.yml\n\n\nWrote .make file makefiles/stock/dkan/lock.yml                                                                             [ok]\n\n\ntmp/drush make-lock makefiles/stock/civicrm/build.yml --result-file=makefiles/stock/civicrm/lock.yml\n\n\nWrote .make file makefiles/stock/civicrm/lock.yml                                                                          [ok]\n\n\ntmp/drush make-lock makefiles/demtools/dkan/build.yml --result-file=makefiles/demtools/dkan/lock.yml\n\n\nWrote .make file makefiles/demtools/dkan/lock.yml                                                                          [ok]\n\n\ntmp/drush make-lock makefiles/demtools/civicrm/build.yml --result-file=makefiles/demtools/civicrm/lock.yml\n\n\nWrote .make file makefiles/demtools/civicrm/lock.yml                                                                       [ok]\n\n\n\n\n\n\nA quick \ngit diff\n will then show any updates to lockfiles.\n\n\nThis behaviour is based on file timestamps, even if the contents have not changed. To see it in action, you can test it with:\n\n\n$\n touch makefiles/stock/dkan/contrib.make.yml\n\nergonlogic@debian:~/code/ndi/NDIplatforms(0.4.x)$\n make all\n\ntmp/drush make-lock makefiles/stock/dkan/build.yml --result-file=makefiles/stock/dkan/lock.yml\n\n\nWrote .make file makefiles/stock/dkan/lock.yml                                                                             [ok]\n\n\ntmp/drush make-lock makefiles/demtools/dkan/build.yml --result-file=makefiles/demtools/dkan/lock.yml\n\n\nWrote .make file makefiles/demtools/dkan/lock.yml                                                                          [ok]\n\n\n\n\n\n\nAs you can see, updating the timestamp on a single file, triggered updates to\nthe two lockfiles that include it. In fact, only\n\nmakefiles/stock/dkan/lock.yml\n depends directly on\n\nmakefiles/stock/dkan/contrib.make.yml\n. The \ndemtools/dkan\n lockfile depends\non the stock dkan lockfile, and so is rebuilt when that one is updated.\n\n\nTest the new lockfile\n\n\nIt is usually worthwhile to test the new lockfile at this point. For example,\nan update to a module could cause a patch to no longer apply. Usually, in such\ncases, updating the makefile with a new patch, or simply removing patches that\nhave been incorporated into the new release, will be sufficient to resolve any\nissues at this stage.\n\n\nAdding or changing patches or libraries, adding new modules or themes, and\nother such modifications can also cause build failures. Running a test build is\nas simple as running:\n\n\n$\n make demtools/dkan-test\n\nBeginning to build makefiles/demtools/dkan/lock.yml.           [ok]\n\n\ndrupal-7.43 downloaded.                                        [ok]\n\n\n[...]\n\n\n\n\n\n\nEach DemTools platform (demtools/dkan, demtools/civicrm, etc.) have such a test\ncommand defined (although it may not show up in the \nmake list\n output).\n\n\nNote that running such a test will re-compile any relevant lockfiles whose\nsources have changed.\n\n\nFinalize the new lockfile\n\n\nOnce any changes or updates are done, we can then commit these changes into git:\n\n\n$\n git commit -am\nUpdate DemTools platforms.", 
            "title": "Maintenance"
        }, 
        {
            "location": "/maintenance/#maintenance", 
            "text": "This section describes how to maintain Drush Make lockfiles. To understand how\nto build platforms using them, please see the  Usage  section. To\nbetter understand how these makefiles are structured, please see the Structure  section.  Please follow the installation instructions in the  Install \nsection, as we currently recommend using a git version of Drush. The usage\ninstructions below assume that you have followed those instructions exactly.  For simplicity, we use the \"demtools/dkan\" project (unless otherwis specified)\nin our examples. Obviously, replace this with whichever platform is\nappropriate.", 
            "title": "MAINTENANCE"
        }, 
        {
            "location": "/maintenance/#drush-make-lockfiles", 
            "text": "The principle benefit of using lockfiles, over regular makefiles, is that they\nallow us to build the same platform in a repeatable fashion. A lockfile is\nsimply a type of makefile generated by Drush, that specifies all the versions\nfor all the included projects. Otherwise, we might get a different platform\neach time we build, depending on how many projects we include, their release\ncycle and/or the pace of their development.  Also, lockfiles allow us to build platforms using the lockfiles remotely,\nwithout having to be concerned with any includes being specified locally. For\nexample, we can use the raw output of a git repository containing such a\nlockfile, and be confident that any subseqent platform built with that same URL\nwill be identical.", 
            "title": "Drush Make lockfiles"
        }, 
        {
            "location": "/maintenance/#update-your-makefiles", 
            "text": "Under normal circumstances, you'll only need to modify makefiles to add or\nremove components from your platform build. Some (very few) makefiles require\nmanual updates to version numbers. The only use-case we are currently aware of\nis when downloading a project or library using the  get  download type. An\nexample of this can be seen in  makefiles/stock/civicrm/contrib.make.yml :  projects:\n  civicrm:\n    type: module\n    download:\n      type: get\n      url:  http://downloads.sourceforge.net/project/civicrm/civicrm-stable/4.6.13/civicrm-4.6.13-drupal.tar.gz   We can see the result of updating a makefile by building our lockfiles with make all  and  git diff . But that is covered in more detail in the next section.", 
            "title": "Update your makefiles"
        }, 
        {
            "location": "/maintenance/#pinning-major-versions", 
            "text": "Occasionally we'll see a new major version of a project released. By default,\nDrush Make will select the most recent supported version of a project. As a\nresult, our lockfiles would show a major version bump as well. Generally\nspeaking, major version upgrades of modules are not a part of the day-to-day\nmaintenance of platforms. They will likely require some manual intervention,\nor, at very least, thorough testing.  Assuming the current version of such a component is still supported, the most\nexpedient solution is likely to involve pinning a major version for the module.\nThis allows new releases on that branch to be incorporated automatically.  For example, in  makefiles/demtools/civicrm/contrib.make.yml , we could replace\nthis:  projects:\n  webform:  {  version :  ~  }  With the following:  projects:\n  webform:\n     # The recommended release is on the 4.x branch, so we pin to the latest \n     # supported version on the 3.x branch. \n    version: 3  Note that it is usually worthwhile to document the reasons for such pinning.\nRebuild the lockfiles, and check what has changed:  $  make all tmp/drush make-lock makefiles/demtools/civicrm/build.yml --result-file=makefiles/demtools/civicrm/lock.yml  Wrote .make file makefiles/demtools/civicrm/lock.yml                                                                       [ok]  $  git diff makefiles/demtools/civicrm/lock.yml  The resulting diff should show something like this:  diff --git a/makefiles/demtools/civicrm/lock.yml b/makefiles/demtools/civicrm/lock.yml  index d3ab256..212a373 100644  --- a/makefiles/demtools/civicrm/lock.yml  +++ b/makefiles/demtools/civicrm/lock.yml  @@ -58,7 +58,7 @@ projects: \n   webform_civicrm:\n     version:  4.15 \n   webform: -    version:  4.12  +    version:  3.24 \n   libraries:\n     version:  2.2 \n   options_element:", 
            "title": "Pinning major versions"
        }, 
        {
            "location": "/maintenance/#update-the-lockfiles", 
            "text": "We use a GNU Makefile to simplify updates to lockfiles. This Makefile defines\ndependencies between the various lockfiles, and their includes. This means that\nwhen a (Drush) makefile is updated, all lockfiles that include that makefile\nwill be rebuilt.  Since we keep all our lockfiles in git, it's often easiest to simply force the\nre-compilation of all the lockfiles:  $  make all -B tmp/drush make-lock makefiles/cores/drupal7/build.yml --result-file=makefiles/cores/drupal7/lock.yml  Wrote .make file makefiles/cores/drupal7/lock.yml                                                                          [ok]  tmp/drush make-lock makefiles/cores/drupal8/build.yml --result-file=makefiles/cores/drupal8/lock.yml  Wrote .make file makefiles/cores/drupal8/lock.yml                                                                          [ok]  tmp/drush make-lock makefiles/stock/dkan/build.yml --result-file=makefiles/stock/dkan/lock.yml  Wrote .make file makefiles/stock/dkan/lock.yml                                                                             [ok]  tmp/drush make-lock makefiles/stock/civicrm/build.yml --result-file=makefiles/stock/civicrm/lock.yml  Wrote .make file makefiles/stock/civicrm/lock.yml                                                                          [ok]  tmp/drush make-lock makefiles/demtools/dkan/build.yml --result-file=makefiles/demtools/dkan/lock.yml  Wrote .make file makefiles/demtools/dkan/lock.yml                                                                          [ok]  tmp/drush make-lock makefiles/demtools/civicrm/build.yml --result-file=makefiles/demtools/civicrm/lock.yml  Wrote .make file makefiles/demtools/civicrm/lock.yml                                                                       [ok]   A quick  git diff  will then show any updates to lockfiles.  This behaviour is based on file timestamps, even if the contents have not changed. To see it in action, you can test it with:  $  touch makefiles/stock/dkan/contrib.make.yml ergonlogic@debian:~/code/ndi/NDIplatforms(0.4.x)$  make all tmp/drush make-lock makefiles/stock/dkan/build.yml --result-file=makefiles/stock/dkan/lock.yml  Wrote .make file makefiles/stock/dkan/lock.yml                                                                             [ok]  tmp/drush make-lock makefiles/demtools/dkan/build.yml --result-file=makefiles/demtools/dkan/lock.yml  Wrote .make file makefiles/demtools/dkan/lock.yml                                                                          [ok]   As you can see, updating the timestamp on a single file, triggered updates to\nthe two lockfiles that include it. In fact, only makefiles/stock/dkan/lock.yml  depends directly on makefiles/stock/dkan/contrib.make.yml . The  demtools/dkan  lockfile depends\non the stock dkan lockfile, and so is rebuilt when that one is updated.", 
            "title": "Update the lockfiles"
        }, 
        {
            "location": "/maintenance/#test-the-new-lockfile", 
            "text": "It is usually worthwhile to test the new lockfile at this point. For example,\nan update to a module could cause a patch to no longer apply. Usually, in such\ncases, updating the makefile with a new patch, or simply removing patches that\nhave been incorporated into the new release, will be sufficient to resolve any\nissues at this stage.  Adding or changing patches or libraries, adding new modules or themes, and\nother such modifications can also cause build failures. Running a test build is\nas simple as running:  $  make demtools/dkan-test Beginning to build makefiles/demtools/dkan/lock.yml.           [ok]  drupal-7.43 downloaded.                                        [ok]  [...]   Each DemTools platform (demtools/dkan, demtools/civicrm, etc.) have such a test\ncommand defined (although it may not show up in the  make list  output).  Note that running such a test will re-compile any relevant lockfiles whose\nsources have changed.", 
            "title": "Test the new lockfile"
        }, 
        {
            "location": "/maintenance/#finalize-the-new-lockfile", 
            "text": "Once any changes or updates are done, we can then commit these changes into git:  $  git commit -am Update DemTools platforms.", 
            "title": "Finalize the new lockfile"
        }, 
        {
            "location": "/documentation/", 
            "text": "DOCUMENTATION \n\n\nWe maintain the NDIplatform documentation site using\n\nmkdocs\n to build this site. To get started\ncontributing to this project, fork it on Github. Then install mkdocs and clone\nthis repo:\n\n\n$\n sudo brew install python              \n# For OSX users\n\n\n$\n sudo aptitude install python-pip      \n# For Debian/Ubuntu users\n\n\n$\n sudo pip install mkdocs\n\n$\n git clone https://github.com/NDItech/NDIplatforms.git\n\n$\n \ncd\n NDIplatforms\n\n$\n git remote add sandbox https://github.com/\nusername\n/NDIplatforms.git\n\n$\n mkdocs serve\n\n\n\n\n\nYour local NDIplatforms docs site should now be available for browsing:\n\nhttp://127.0.0.1:8000/\n. When you find a typo, an error, unclear or missing\nexplanations or instructions, hit ctrl-c, to stop the server, and start\nediting. Find the page you\u2019d like to edit; everything is in the docs/\ndirectory. Make your changes, commit and push them, and start a pull request:\n\n\n$ git checkout -b fix_typo\n$ vim docs/index.md                     \n# Add/edit/remove whatever you see fit. Be bold!\n\n$ mkdocs build --clean; mkdocs serve    \n# Go check your changes. We\u2019ll wait...\n\n$ git diff                              \n# Make sure there aren\u2019t any unintended changes.\n\ndiff --git a/docs/index.md b/docs/index.md\n...\n$ git commit -am\u201dFixed typo.\u201d           \n# Useful commit message are a good habit.\n\n$ git push sandbox fix_typo\n\n\n\n\n\nVisit your fork on Github and start a Pull Request.", 
            "title": "Documentation"
        }, 
        {
            "location": "/documentation/#documentation", 
            "text": "We maintain the NDIplatform documentation site using mkdocs  to build this site. To get started\ncontributing to this project, fork it on Github. Then install mkdocs and clone\nthis repo:  $  sudo brew install python               # For OSX users  $  sudo aptitude install python-pip       # For Debian/Ubuntu users  $  sudo pip install mkdocs $  git clone https://github.com/NDItech/NDIplatforms.git $   cd  NDIplatforms $  git remote add sandbox https://github.com/ username /NDIplatforms.git $  mkdocs serve  Your local NDIplatforms docs site should now be available for browsing: http://127.0.0.1:8000/ . When you find a typo, an error, unclear or missing\nexplanations or instructions, hit ctrl-c, to stop the server, and start\nediting. Find the page you\u2019d like to edit; everything is in the docs/\ndirectory. Make your changes, commit and push them, and start a pull request:  $ git checkout -b fix_typo\n$ vim docs/index.md                      # Add/edit/remove whatever you see fit. Be bold! \n$ mkdocs build --clean; mkdocs serve     # Go check your changes. We\u2019ll wait... \n$ git diff                               # Make sure there aren\u2019t any unintended changes. \ndiff --git a/docs/index.md b/docs/index.md\n...\n$ git commit -am\u201dFixed typo.\u201d            # Useful commit message are a good habit. \n$ git push sandbox fix_typo  Visit your fork on Github and start a Pull Request.", 
            "title": "DOCUMENTATION"
        }
    ]
}